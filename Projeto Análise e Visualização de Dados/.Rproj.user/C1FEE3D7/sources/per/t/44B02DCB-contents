---
title: "Aula_8"
format: html
editor: visual
---

```{r}
#Anova em blocos casualizados 
library(tidyverse)
library(gsheet)
soja <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=866852711")

#preciso deles como fator 
soja <- soja |>
  mutate (TRAT = as.factor(TRAT),
          Bloco = as.factor(BLOCO))
soja
#visualizar 
dfc <- soja|>
  ggplot(aes(TRAT, DFC))+
  geom_jitter (width = 0.1)
  
dfc
```

```{r}
#visualizar 
fer <- soja|>
  ggplot(aes(TRAT, DFC))+
  geom_jitter (width = 0.1)
  
fer
```

```{r}
#visualizar 
prod <- soja|>
  ggplot(aes(TRAT, PROD))+
  geom_jitter (width = 0.1)
  
prod

library(patchwork)
dfc|fer|prod

```

```{r}
##G´raico com intervalo de confiança 

install.packages("Hmisc")
library(Hmisc)

dfc <- soja |>
  ggplot (aes (TRAT, DFC))+
  geom_jitter (width = 0.1, color = "gray70") + 
  stat_summary(fun.data = "mean_cl_boot", color = "black", alpha = 0.5)
dfc

```

```{r}

```

```{r}
#Anova DFC 

aov_dfc <-lm(DFC ~TRAT + BLOCO, data = soja)
anova(aov_dfc)
```

```{r}
library(performance)
check_heteroscedasticity(aov_dfc)
check_normality(aov_dfc)
library(emmeans)
medias_dfc <- emmeans(aov_dfc, ~TRAT)
medias_dfc
pwpm(medias_dfc)
library(multcomp)
cld(medias_dfc, Letters = LETTERS)

aov_fer <-lm(FER ~TRAT + BLOCO, data = soja)
anova(aov_fer)

check_heteroscedasticity(aov_fer)
check_normality(aov_fer)

#tranSformar
aov_fer<- lm (log(FER) ~TRAT + BLOCO, data = soja)
anova(aov_fer)

library(performance)
check_heteroscedasticity(aov_fer)
check_normality(aov_fer)

b <- boxcox(lm(soja$FER ~ 1))
lambda <- b$x[which.max(b$y)]
lambda
soja$FER <- (soja$FER ^lambda - 1) / lambda

#destranformar
install.packages("forecast")
library(forecast)
InvBoxCox(0.63, lambda)

library(emmeans)
medias_fer <- emmeans(aov_fer, ~TRAT)
medias_fer

pwpm(medias_fer)

library(multcomp)
medias_fer_group <- cld(medias_fer, Letters = LETTERS) 


```

```{r}
#gráfico com intervalo de confiança com as letrinhas 
medias_fer
df_fer<-data.frame(medias_fer_group)
df_fer|>
  ggplot(aes(TRAT, emmean))+
  geom_point()+
  ylim(0, 25)+
  geom_errorbar(aes(min = lower.CL, 
                    max = upper.CL), width = 0.1)+
  annotate(geom = "text", x = 1.2, y=20, label = "A")

knitr::kable(medias_fer_group |>dplyr::select(TRAT, emmean, .group))

#baixar o arquivo em word

install.packages("writex1")
library(writex1)

write_xlsx(df_dfc, "df.xlsx")

```

```{r}
library(gsheet)
curve <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=1807247585")

curve$Irrigation  <- as.vector(curve$Irrigation )
curve$day <- as.vector(curve$day)

data1 <- curve|>
  group_by(Irrigation, day)|>
  summarise(mean_severity = mean (severity))
data1


data1 |>
  ggplot(aes(day, mean_severity, fill = Irrigation, color = Irrigation)) +
  geom_point(alpha = 1, width = 1.7, shape = 21, stroke = 0, size = 2.7) +
  geom_line(aes(mean_severity)) 

data1



## area abaixo da curva de progresso da doença 
library(tidyverse)
install.packages("epifitter")
library(epifitter)

curve2<- curve|>
  group_by(Irrigation, rep) |> 
  summarise(aacpd = AUDPC(day, severity))

m_curve<- lm(aacpd ~Irrigation + factor(rep, data = curve2))

anova(m_curve)

library(agricolae)
cv.model(m_curve)




##calcular o coeficiente de variação com o aov de agricolae 
library(agricolae)
cv.model(m_curve)
```
